# editÏlan for DaVinci Resolve

> **Technical Name:** EditPlan for Resolve
> **Display Name:** editÏlan for Resolve

Plan-driven AI editing plugin for DaVinci Resolve (Transcription + B-roll Matching + Multicam Sync)

---

## ğŸ“Œ Quick Reference

### Naming Strategy
- **UI/Brand:** editÏlan (Ï = Rho, creator signature + engineering precision)
- **System/Package:** EditPlan (file paths, CLI compatibility)

### Stack
Python 3.12 Â· PySide6 Â· SQLite (FTS5 + Vector) Â· OpenCLIP Â· Whisper Â· OpenCV Â· Resolve API

### Execution
- **Launch:** `Workspace â†’ Scripts â†’ Comp â†’ VideoForge`
- **Deploy:** `robocopy VideoForge "$env:APPDATA\...\Scripts\Comp\VideoForge\VideoForge" /E`
- **Logs:** `%APPDATA%\Blackmagic Design\DaVinci Resolve\...\EditPlan.log`

---

## ğŸ—ï¸ Architecture

```
VideoForge/
â”œâ”€â”€ adapters/      # CLIP, Audio, Video, SAM3/Audio (WSL subprocess)
â”œâ”€â”€ ai/            # LLM hooks, ComfyUI prompt generation
â”œâ”€â”€ broll/         # Indexer, Matcher, Placer, Generators, Quality checker
â”œâ”€â”€ core/          # Transcriber, SegmentStore, TimelineBuilder, SyncMatcher
â”œâ”€â”€ integrations/  # ResolveAPI
â”œâ”€â”€ multicam/      # BoundaryDetector, AngleScorer, AngleSelector, PlanGenerator
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ icons/             # SVG sidebar icons (6)
â”‚   â”œâ”€â”€ sections/          # Page builders (analyze, edit, library, match, sync, beat, multicam, settings)
â”‚   â”œâ”€â”€ widgets/           # CollapsibleCard
â”‚   â”œâ”€â”€ library_manager.py # Standalone DB tool
â”‚   â””â”€â”€ main_panel.py      # VSCode-style sidebar
â””â”€â”€ config/        # settings.yaml, z_image_turbo.json (ComfyUI)
```

---

## âš¡ Core Rules

1. **Resolve API â†’ Main Thread ONLY** (no Worker threads)
2. **Never delete Whisper model** (del/gc.collect â†’ crash)
3. **Draft Mode is non-destructive** (UID tracking, render-time application)
4. **OpenCV scene detection preferred** (25% accuracy boost over time-based)
5. **Quality validation + retry** (max 3 retries for low-quality stock/AI)
6. **OpenCV subprocess mode** (avoid Resolve DLL conflicts)
7. **SAM models via WSL subprocess** (HuggingFace official environment)

---

## ğŸ¯ Feature Summary

| Phase | Feature | Key Files | Details |
|-------|---------|-----------|---------|
| **3** | ComfyUI Integration | `comfyui_generator.py`, `prompt_generator.py` | AI B-roll generation with LLM prompts |
| **4** | OpenCV Analysis | `video_analyzer.py`, `scene_detector.py`, `quality_checker.py` | Scene cuts (Bhattacharyya), quality gates (blur/brightness/noise) |
| **5** | Library Manager | `library_manager.py` | Standalone DB tool: pagination, thumbnails, metadata edit, batch ops |
| **6** | SAM3 + Audio | `sam3_worker.py`, `sam_audio_worker.py` | Manual video segmentation & audio separation (WSL) |
| **7** | Global/Local Library | `library_section.py` | Dual DB (global shared + project-local), search scope toggle |
| **8** | Audio Sync | `audio_sync.py`, `sync_matcher.py` | Silence pattern matching (same/inverse), cross-correlation, offset calculation |
| **9** | Hybrid Sync | `voice_detector.py`, `content_matcher.py` | Silero VAD (speech), librosa (chroma/onset) |
| **11** | Multicam Cutter | `boundary_detector.py`, `angle_scorer.py`, `plan_generator.py` | Sentence-based cuts, OpenCV angle scoring, rule-based selection |

---

## ğŸ¨ UI (v2.0.0)

### VSCode-Style Sidebar
- **6 pages:** Transcribe, Edit, Multicam, B-roll, Beat, Settings
- **Navigation:** Click icons OR Ctrl+1~6, Ctrl+[ / ]
- **Animations:** 150ms fade transitions, collapsible card slides
- **Status bar:** 3-part (status | timeline info | error count)

### DaVinci Color Palette
```python
bg_window: #1F1F1F   bg_panel: #292929   bg_card: #252525
text_main: #CCCCCC   text_dim: #999999   accent: #4C8BF5
success: #6E9C76     error: #F54E4E      warning: #FFA500
```

---

## âš™ï¸ Config Keys (Critical)

### Library
```python
global_library_db_path  # Global shared library
local_library_db_path   # Project-local library
library_search_scope    # "both" | "global" | "local"
```

### Audio Sync
```python
audio_sync_threshold_db: -40.0       # Silence threshold
audio_sync_min_silence: 0.3          # Min duration (s)
audio_sync_max_offset: 30.0          # Search window (s)
audio_sync_min_confidence: 0.5       # Match threshold
```

### Multicam
```python
multicam_max_segment_sec: 10.0       # Max segment length
multicam_min_hold_sec: 2.0           # Min hold time
multicam_max_repeat: 3               # Max same-angle repeats
multicam_boundary_mode: "hybrid"     # "sentence" | "fixed" | "hybrid"
```

---

## ğŸ“– Version History

- **v2.0.0** (2026-01-02) - UI Redesign + Rebranding to editÏlan
- **v1.12.0** (2025-01-XX) - Phase 11 Auto Multicam Cutter
- **v1.10.0** (2025-XX-XX) - VideoForge legacy

---

## ğŸ”§ Session Handoff Template

```markdown
[Session Context]
Date: YYYY-MM-DD
Branch: [branch-name]
Last Commit: [hash] - [message]

[Goal]
- Primary: [what you're trying to achieve]
- Phase: [if applicable]

[Recent Changes]
- Modified: [file1.py, file2.py]
- Added: [file3.py]
- Behavior: [what changed]

[Known Issues]
- [Bug/Warning description]
- Main-thread violations: [yes/no]

[Tool Routing]
- UI action â†’ Handler: [main thread]
- Heavy work â†’ Worker: [background thread]

[LLM Config]
- Provider: [gemini/openai/disabled]
- Model: [model-name]
- API Key: [configured/missing]

[Deploy]
robocopy VideoForge "$env:APPDATA\...\VideoForge\VideoForge" /E
robocopy scripts\Comp\VideoForge "$env:APPDATA\...\VideoForge" /E

[Verification]
- Launch: Workspace â†’ Scripts â†’ Comp â†’ VideoForge
- Check: [UI indicator / log line]
```

**Critical Reminders:**
- Resolve API calls MUST be on main thread
- UI updates MUST be on main thread
- Worker threads MUST NOT call Resolve API
- Never fabricate resultsâ€”return status-only if uncertain
